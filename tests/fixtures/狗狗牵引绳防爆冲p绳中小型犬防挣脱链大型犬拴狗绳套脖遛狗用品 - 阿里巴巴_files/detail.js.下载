(function(){if(window.FEENV!=="prod"||!window.performance){return}var loginId=FE_GLOBALS.loginId;var sendRecord=function sendRecord(params){var url=new URL("https://takla.cn-shanghai.log.aliyuncs.com/logstores/csp/track?APIVersion=0.6.0");var searchParams=url.searchParams;params.UUID=window.traceId;params.loginId=loginId;params.userAgent=navigator.userAgent;params.url=location.href;params.pageId=window.TD_PAGE_ID||'unkown';params.version=context.version;delete params.contextPath;delete params.operatorName;Object.keys(params).forEach(function(item){if(params[item]&&typeof params[item]==="object"){searchParams.set(item,JSON.stringify(params[item]))}else{if(params[item]){searchParams.set(item,params[item])}}});new Image().src=url};addEventListener("sendBeacon",function(e){sendRecord(Object.assign({},e.detail||{}))});addEventListener("beforeunload",function(){var cspReport={};var isWhiteList=function isWhiteList(domain){return/dev|arms|localhost|127.0.0.1|.(1688|mmstat|alicdn|taobao|alibaba|tmall).com|takla/.test(domain)};performance.getEntries().forEach(function(item){var name=item.name,initiatorType=item.initiatorType;var domain=name.split("/").filter(Boolean)[1];if(!/^http/i.test(name)||/navigation/.test(initiatorType)){return}if(!isWhiteList(domain)&&!/img|beacon/.test(initiatorType)){cspReport[initiatorType]=cspReport[initiatorType]||new Set();cspReport[initiatorType].add(domain)}});Object.keys(cspReport).forEach(function(item){if(cspReport[item] instanceof Set){cspReport[item]=Array.from(cspReport[item]).join(",")}});if(Object.keys(cspReport).length){sendRecord({logName:"CSP",logRsv:cspReport})}})})();